
{% extends "fn_portal/fn_portal_base.html" %}

{% block content  %}

    <div class='container'>
        <h2>Project Data Upload</h2>

        {% if messages %}
            {% for message in messages %}
                <div class="alert
                            {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %} alert-success {% else %} alert-danger {% endif %}" role="alert">
                    <h4 class="alert-heading">
                        {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %} Success {% else %} Aw Snap! {% endif %}
                    </h4>
                    <p> {{ message }} </p>
                </div>
            {% endfor %}
        {% endif %}

        <div class="panel panel-default">
            <div class="panel-body">
                Some helpful hint here... Only accdb files will be accepted, make sure that you have run process
                validate against your database and fixed all of the identified errors and critical errors....

                <ul>
                    <li>Choose project/template type here</li>
                    <li>Add other views to upload age updates</li>
                    <li>Options to overwrite, append, update (upsert)</li>
                </ul>
            </div>
        </div>

        <form action="{% url "fn_portal:upload_project_data" %}" method="POST"
              enctype="multipart/form-data" id="upload-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="data_file">Data Upload</label>
                <input type="file" name="data_file" id="data_file" required="True" accept=".accdb">
                <div class="help-block">Select your validated template database.</div>

                <button type="submit" class="btn btn-primary" id="form-submit-button">Upload</button>
                <button id="processing-button" class="btn btn-primary" disabled style="display: none">
                    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                    Processing...
                </button>
            </div>
        </form>



        {% if errors %}

            <div class="container">

                <hr/>

                {% with error_count=errors.count %}
                    <h4>The following {{ error_count }} error{{error_count|pluralize}} where found by the validation process and must be fixed before proceeding:</h4>
                {% endwith %}

                {% for error in errors %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Table: {{error.table}}</h3>
                        </div>
                        <div class="panel-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <td>Slug</td>
                                        <td>Field(s)</td>
                                        <td>Error Message</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>{{error.slug}}</td>
                                        <td>{{error.fields}}</td>
                                        <td>{{error.message}}</td>
                                    </tr>
                                </tbody>

                            </table>
                        </div>
                    </div>

                {% endfor %}

            </div>
        {% endif  %}


{% endblock content %}



{% block scripts %}

    <script>

     $(document).ready(function() {
         $("#form-submit-button").click(function() {
             $("#form-submit-button").hide();
             $("#processing-button").show();
             $("#upload-form").submit();
         });
     });

    </script>

{% endblock %}
